<!DOCTYPE html>
<html lang="en">
<head>
    <!--쿠키, 토큰 발급용/필요에 따라 수정 할것 -->
    <!--1. main page와 스타일 맞추기       -->
    <!--2. 폰트 결정하기        -->
    <!-- Webpage Title -->
    <title>Meat up - 맛집을 함께 즐겨요!</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <meta property="og:title" content="Meat up - 맛집을 함께 즐겨요!"/>
    <meta property="og:description" content="mini project for Web Plus"/>
    <meta property="og:image" content="{{ url_for('static', filename='ogimg.png') }}"/>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <!-- Font Awesome CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&family=Stylish&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='mystyle.css') }}" rel="stylesheet">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="{{ url_for('static', filename='myjs.js') }}"></script>

    <style>
        .title {
            font-weight: 800;
            font-size: 5rem;
            font-family: 'Stylish', sans-serif;
        }

        .subtitle {
            font-family: 'Gamja Flower', cursive;
            font-size: 2rem;

        }

        .help {
            color: gray;
        }
    </style>

    <style>
        .card {
            width: 500px;
            height: 400px;
            margin: auto;
        }
    </style>
    <script>
        $(document).ready(function () {
        });
        function foo(torf, title) {
console.log(torf);
console.log(title)
console.log("why the fuck")
            }

        function save_gathering() {
            let title = $('#title').val()
            let date = $('#date').val()
            let agenda = $('#agenda').val()
            let max_guests = $('#max_guests').val()
            let location = $('#location').val()
            let restaurant = $('#restaurant').val()
console.log(max_guests)
            $.ajax({
                type: "POST",
                url: '/api/gathering_create',
                data: {
                    title_give: title,
                    date_give: date,
                    agenda_give: agenda,
                    max_guests_give: max_guests,
                    location_give: location,
                    restaurant_give: restaurant,
                },
                success: function (response) {
                    alert(response["msg"])
window.location.reload()
                }
            });
        }
        // 어떤 버튼(참가, 취소)으로 참가했냐에 따라서 인자를 따로 전달
        // ex : 참석 버튼 -> gathering_join(false)
        function gathering_join(bool_by_button, gathering_title) {
            let is_cancel = bool_by_button;
            //title은 카드에서 따올 예정, 지금은 임시
            let title = gathering_title;

            $.ajax({
                type: "POST",
                url: '/gathering_join',
                data: {
                    title_give: title,
                    is_cancel_give: is_cancel
                },
                success: function (response) {
                    alert(response["msg"])
window.location.reload()
                }
            });
        }

        /* 9/15 오전 추가 내용_update_gathering */
        function update_gethering(title, date, agenda, max_guests, location, restaurant) {
console.log(title, date, agenda, max_guests, location, restaurant)
            $.ajax({
                type: "POST",
                url: "/api/update",
                data: {
                    title_give: title,
                    date_give: date,
                    agenda_give: agenda,
                    max_guests_give: max_guests,
                    location_give: location,
                    restaurant_give: restaurant,
                },
                success: function (response) {
                    alert(response["msg"])
window.location.reload();
                }
            });
        }

        /* 9/15 오전 추가 내용_delete_gathering */
        function delete_gethering(title) {
            $.ajax({
                type: "POST",
                url: "/api/delete",
                data: {
                    title_give: title,
                },
                success: function (response) {
                    alert(response["msg"])
window.location.reload();
                }
            });
        }

    </script>
</head>
<body class="has-navbar-fixed-top">
    <!-- 화면구성 -->
    <nav class="navbar is-fixed-top is-white" id="navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="/">
                <img src="{{ url_for('static', filename='logo.png') }}">
                <strong class="is-sparta"
                        style="font-family: 'Stylish', sans-serif;font-size: larger;">M-EAT-UP</strong>
            </a>
        </div>
    </nav>
    <button class="button is-large is-outlined" onclick='$("#modal-post").addClass("is-active")'>모임 만들기</button>
    <section class="section" id="post_box2">
        {% for gathering in gatherings|reverse %}
            <div id="post-box" class="container">
                <div class="box">
                    <article class="media">
                        <div class="media-left">
                            <div class="media-left">
                                <a class="image is-64x64" href="#">
                                    <img class="is-rounded"
                                         src={{ url_for("static", filename="sample.jpg") }} alt="Image">
                                </a>
                            </div>
                            </a>
                        </div>
                        <div class="media-content">
                            <div class="content">
                                <p>
                                    <strong>{{ gathering.title }}</strong> <small>@ {{ gathering.location }} D-{ }</small>
                                    <br>
                                    {{ joind_counter[gathering.title] }}/{{ gathering.max_guests }}명
                                </p>
                            </div>
                            <nav class="level is-mobile">
                                <button class="button is-link is-outlined" id="btn-gathering-detail"
                                        onclick='$("#modal-gathering{{ loop.index }}").addClass("is-active")'>자세히 보기</button>

                            </nav>
                        </div>
                    </article>
                </div>
            </div>
            <div class="modal" id="modal-gathering{{ loop.index }}">
                <div class="modal-background"
                     onclick='$("#modal-gathering{{ loop.index }}").removeClass("is-active")'></div>
                <div class="modal-card">
                    <header class="modal-card-head">
                        <p class="modal-card-title">{{ gathering.title }}</p>
                        <button class="delete" aria-label="close"
                                onclick='$("#modal-gathering{{ loop.index }}").removeClass("is-active")'></button>
                    </header>
                    <section class="modal-card-body">
                        <div class="content">
                            <p>날짜 : {{ gathering.date }}</p>
                            <p>내용 : {{ gathering.agenda }}</p>
                            <p>인원수 : {{ joind_counter[gathering.title] }} / {{ gathering.max_guests }}</p>
                            <p>장소 : {{ gathering.location }}</p>
                            <p>식당 : {{ gathering.restaurant }}</p>
                        </div>
                    </section>
                    <footer class="modal-card-foot">
                        {% if userid == gathering.host %}
                            <button class="button is-success">Revise</button>
                            <button class="button is-success" onclick="delete_gethering('{{ gathering.title }}')">
                                Delete
                            </button>
                        {% else %}
                            <button class="button is-success" onclick="gathering_join(0, '{{ gathering.title }}')">
                                Join
                            </button>
                            <button class="button is-success" onclick="gathering_join(1, '{{ gathering.title }}')">
                                Cancel
                                Gathering
                            </button>
                        {% endif %}
                        <button class="button" onclick='$("#modal-gathering{{ loop.index }}").removeClass("is-active")'>
                            Cancel
                        </button>
                    </footer>
                </div>
                <button class="modal-close is-large" aria-label="close"
                        onclick='$("#modal-gathering{{ loop.index }}").removeClass("is-active")'></button>
            </div>
        {% endfor %}
    </section>

    <!--modal 모음 -->
    <div class="modal" id="modal-post">
            <div class="modal-background" onclick='$("#modal-post").removeClass("is-active")'></div>
            <div class="modal-content">
                <div class="box">
                    <article class="media">
                        <div class="media-content">
                            <div class="field">
                                <div id="gathering_create_box">
                                    <div>제목<input class="input is-small" type="text" id="title" placeholder="모임 제목을 설정해주세요">
                                    </div>
                                    <div>일자 <input class="input is-small" type="date" id="date"></div>
                                    <div>내용 <textarea class="textarea" placeholder="모임 참석 내용" rows="10"
                                                      id="agenda"></textarea></div>
                                    <div>최대인원 <input class="input is-small" type="number" id="max_guests"></div>
                                    <div>위치 <input class="input is-small" type="text" id="location"></div>
                                    <div>맛집정보 <input class="input is-small" type="text" id="restaurant"></div>
                                </div>
                            </div>
                            <nav class="level is-mobile">
                                <div class="level-left">

                                </div>
                                <div class="level-right">
                                    <div class="level-item">
                                        <a class="button is-sparta" onclick="save_gathering()" id="create_btn">모임 작성</a>
                                    </div>
                                    <div class="level-item">
                                        <a class="button is-sparta is-outlined"
                                           onclick='$("#modal-post").removeClass("is-active")'>취소</a>
                                    </div>
                                </div>
                            </nav>
                        </div>
                    </article>
                </div>
            </div>
            <button class="modal-close is-large" aria-label="close"
                    onclick='$("#modal-post").removeClass("is-active")'></button>
        </div>
    <div class="modal" id="modal-gathering">
        <div class="modal-background" onclick='$("#modal-gathering").removeClass("is-active")'></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">생성된 모임 정보</p>
                <button class="delete" aria-label="close" onclick='$("#modal-gathering").removeClass("is-active")'></button>
            </header>
            <section class="modal-card-body">

            </section>
            <footer class="modal-card-foot">
                <button class="button is-success">Save changes</button>
                <button class="button" onclick='$("#modal-gathering").removeClass("is-active")'>Cancel</button>
            </footer>
        </div>
        <button class="modal-close is-large" aria-label="close"
                onclick='$("#modal-gathering").removeClass("is-active")'></button>
    </div>
</body>
</html>