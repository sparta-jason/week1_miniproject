<!DOCTYPE html>
<html lang="en">
<head>
    <!--쿠키, 토큰 발급용/필요에 따라 수정 할것 -->
    <!--1. main page와 스타일 맞추기       -->
    <!--2. 폰트 결정하기        -->
    <!-- Webpage Title -->
    <title>맛집 뭐시기 페이지 메인</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <meta property="og:title" content="스위터 - 세상을 달달하게"/>
    <meta property="og:description" content="mini project for Web Plus"/>
    <meta property="og:image" content="{{ url_for('static', filename='ogimg.png') }}"/>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <!-- Font Awesome CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&family=Stylish&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='mystyle.css') }}" rel="stylesheet">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="{{ url_for('static', filename='myjs.js') }}"></script>



    <style>
        .title {
            font-weight: 800;
            font-size: 5rem;
            font-family: 'Stylish', sans-serif;
        }

        .subtitle {
            font-family: 'Gamja Flower', cursive;
            font-size: 2rem;

        }

        .help {
            color: gray;
        }
    </style>

   <style>
        .card {
            width : 500px;
            height : 400px;
            margin : auto;
        }
    </style>
    <script>
        $(document).ready(function () {
            gathering_infomation();
        });

        function save_gathering() {
            let title = $('#title').val()
            let date = $('#date').val()
            let agenda = $('#agenda').val()
            let max_guests = $('#max_guests').val()
            let location = $('#location').val()
            let restaurant = $('#restaurant').val()

            $.ajax({
                type: "POST",
                url: '/api/gathering_create',
                data: {
                    title_give: title,
                    date_give: date,
                    agenda_give: agenda,
                    max_guests_give: max_guests,
                    location_give: location,
                    restaurant_give: restaurant,
                },
                success: function (response) {
                    alert(response["msg"])
                    window.location.reload()
                }
            });
        }

        function gathering_infomation() {
            $('#cards-box').empty()
            $.ajax({
                type: "GET",
                url: "/gatherings",
                data: {},
                success: function (response) {
                    let gatherings = response['all_gatherings']
                    console.log(gatherings)
                    for (let i = 0; i < gatherings.length; i++) {
                        let title = gatherings[i]['title']
                        let date = gatherings[i]['date']
                        let agenda = gatherings[i]['agenda']
                        let max_guests = gatherings[i]['max_guests']
                        let location = gatherings[i]['location']
                        let restaurant = gatherings[i]['restaurant']


                        let temp_html = `<div class="card">
                                            <img class="card-img-top"
                                                 src=""
                                                 alt="Card image cap">
                                            <div class="card-body">
                                                <a target="_blank" href="" class="card-title">${title}</a>
                                                <p class="card-text">날짜 : ${date}</p>
                                                <p class="card-text">${agenda}</p>
                                                <p class="card-text">최대인원수 : ${max_guests}</p>
                                                <p class="card-text">장소 : ${location}</p>
                                                <p class="card-text">식당 : ${restaurant}</p>
                                             </div>
                                         </div>`
                        $('#cards-box').append(temp_html)
                    }
                }
            })
        }
        // 어떤 버튼(참가, 취소)으로 참가했냐에 따라서 인자를 따로 전달
        // ex : 참석 버튼 -> gathering_join(false)
        function gathering_join(bool_by_button) {
            let is_cancel = bool_by_button;
            //title은 카드에서 따올 예정, 지금은 임시
            let title = $('#title').val();

            $.ajax({
                type: "POST",
                url: '/gathering_join',
                data: {
                    title_give: title,
                    is_cancel_give: is_cancel
                },
                success: function (response) {
                    alert(response["msg"])
                    window.location.reload()
                }
            });
        }

    </script>
</head>
<body class="has-navbar-fixed-top">
    <h1>모임 생성</h1>


<button id="test_button" onclick='$("#modal-gathering").addClass("is-active")'>자세히 보기 예시</button>
<div class="modal" id="modal-gathering">

    <div class="modal-background" onclick='$("#modal-gathering").removeClass("is-active")'></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">생성된 모임 정보</p>
            <button class="delete" aria-label="close" onclick='$("#modal-gathering").removeClass("is-active")'></button>
        </header>
        <section class="modal-card-body">
            <!-- Content ... -->
        </section>
        <footer class="modal-card-foot">
            <button class="button is-success">Save changes</button>
            <button class="button" onclick='$("#modal-gathering").removeClass("is-active")'>Cancel</button>
        </footer>
    </div>
    <button class="modal-close is-large" aria-label="close"
            onclick='$("#modal-gathering").removeClass("is-active")'></button>
</div>


<nav class="navbar is-fixed-top is-white" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            <img src="{{ url_for('static', filename='logo.png') }}">
            <strong class="is-sparta"
                    style="font-family: 'Stylish', sans-serif;font-size: larger;">SWEETER</strong>
        </a>
    </div>
</nav>
<section class="section">
    <article class="media">
        <figure class="media-left" style="align-self: center">
            <a class="image is-32x32" href="/user/{{ user_info.username }}">
                <img class="is-rounded" src="{{ url_for('static', filename=user_info.profile_pic_real) }}">
            </a>
        </figure>
        <div class="media-content">
            <div class="field">
                <p class="control">
                    <input id="input-post" class="input is-rounded" placeholder="?"
                           onclick='$("#modal-post").addClass("is-active")'>
                </p>
            </div>
        </div>
    </article>


    <div class="modal" id="modal-post">
        <div class="modal-background" onclick='$("#modal-post").removeClass("is-active")'></div>
        <div class="modal-content">
            <div class="box">
                <article class="media">
                    <div class="media-content">
                        <div class="field">

                                <div id="gathering_create_box">
                                    <div>제목<input class="input is-small" type="text" id="title" placeholder="모임 제목을 설정해주세요"></div>
                                    <div>일자 <input class="input is-small" type="date" id="date"></div>
                                    <div>내용 <textarea class="textarea" placeholder="모임 참석 내용" rows="10" id="agenda"></textarea></div>
                                    <div>최대인원 <input class="input is-small" type="number" id="max-guest"></div>
                                    <div>위치 <input class="input is-small" type="text" id="location"></div>
                                    <div>맛집정보 <input class="input is-small" type="text" id="restaurant"></div>



                                </div>
                        </div>
                        <nav class="level is-mobile">
                            <div class="level-left">

                            </div>
                            <div class="level-right">
                                <div class="level-item">
                                    <a class="button is-sparta" onclick="save_gathering()" id="create_btn">모임 작성</a>
                                </div>
                                <div class="level-item">
                                    <a class="button is-sparta is-outlined"
                                       onclick='$("#modal-post").removeClass("is-active")'>취소</a>
                                </div>
                            </div>
                        </nav>
                    </div>
                </article>
            </div>
        </div>
        <button class="modal-close is-large" aria-label="close"
                onclick='$("#modal-post").removeClass("is-active")'></button>
    </div>



</section>
<section class="section" id = "post_box2" >
    <div id="post-box" class="container">
        <div class="box">
            <article class="media">
                <div class="media-left">
                    <a class="image is-64x64" href="#">
                        <img class="is-rounded"
                             src={{ url_for("static", filename="profile_pics/profile_placeholder.png") }} alt="Image">
                    </a>
                </div>
                <div class="media-content">
                    <div class="content">
                        <p>
                            <strong>홍길동</strong> <small>@username</small> <small>10분 전</small>
                            <br>
                            글을 적는 칸
                        </p>
                    </div>
                    <nav class="level is-mobile">
                        <div class="level-left">
                            <a class="level-item is-sparta" aria-label="heart"
                               onclick="toggle_like('', 'heart')">
                                        <span class="icon is-small"><i class="fa fa-heart"
                                                                       aria-hidden="true"></i></span>&nbsp;<span
                                    class="like-num">2.7k</span>
                            </a>
                        </div>

                    </nav>
                </div>
            </article>
        </div>

    </div>
</section>
    <div class="card">
        <header class="card-header">
            <p class="card-header-title">
                Title
            </p>
            <button class="card-header-icon" aria-label="more options">
      <span class="icon">
        <i class="fas fa-angle-down" aria-hidden="true"></i>
      </span>
            </button>
        </header>
        <div class="card-content">
            <div class="content">
                <p>날짜 : </p>
                <p>내용 : </p>
                <p>최대인원수 : </p>
                <p>장소 : </p>
                <p>식당 : </p>
            </div>
        </div>
        <footer class="card-footer">
            <a href="#" class="card-footer-item">자세히 보기</a>
        </footer>
    </div>
</body>
</html>
